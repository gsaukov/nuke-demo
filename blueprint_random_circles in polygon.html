<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }

        #map {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet.js"></script>
<script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
<script>

    const map = L.map("map").setView([48.1140951, 37.7551389], 13);
    L.control.scale().addTo(map);
    const osmTl = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);


    var cities = new L.LayerGroup();

    // create a SVG radial gradient
    // create a temporary marker to get the default marker layer
    let circleMarker = L.circle([14.0100298, 120.9965796], {
        radius: 1
    }).addTo(map);

    // get a reference to the SVG element
    const svg = circleMarker.getElement().farthestViewportElement
    const defs = svg.querySelector('defs') || svg.insertBefore( document.createElementNS(svg.namespaceURI,'defs'), svg.firstChild);
    circleMarker.remove()
    function createGradient(svgElem, id, stops) {
        const radGrad = document.createElementNS(svg.namespaceURI, "radialGradient");
        radGrad.setAttribute("id", id);
        for (let s of stops) {
            const stop = document.createElementNS(svg.namespaceURI, "stop");
            for (let k in s) {
                stop.setAttribute(k, s[k]);
            }
            radGrad.appendChild(stop);
        }
        defs.appendChild(radGrad);
    }
    createGradient(svg, "radgrad", [
        {offset: "0%", "stop-color": "#f00"},
        {offset: "60%", "stop-color": "#ff7300"},
        {offset: "75%", "stop-color": "rgb(0,157,255)"},
        // {offset: "90%", "stop-color": "white"},
        {offset: "95%", "stop-color": "rgba(255,255,255,0.2)"},
        {offset: "100%", "stop-color": "rgba(255,255,255,0)"},
    ]);
    // end radial gradient creation

    function randomPointInPolygon (polygon) {
        var bounds = polygon.getBounds();
        var x_min  = bounds.getEast();
        var x_max  = bounds.getWest();
        var y_min  = bounds.getSouth();
        var y_max  = bounds.getNorth();

        var lat = y_min + (Math.random() * (y_max - y_min));
        var lng = x_min + (Math.random() * (x_max - x_min));

        var point  = turf.point([lng, lat]);
        var poly   = polygon.toGeoJSON();
        var inside = turf.inside(point, poly);

        if (inside) {
            return point
        } else {
            return randomPointInPolygon(polygon)
        }
    }

    async function getPolygonFromOverpass() {
        // id 3602216724 > https://nominatim.openstreetmap.org/search?X-Requested-With=overpass-turbo&format=json&q=Tashkent

        const query = "[out:json];area(id:3602216724);rel(pivot);out body geom;";
        // const query = "[out:json];node(48.865,2.25,48.9,2.27)[amenity=restaurant];out;";
        const encodedQuery = encodeURIComponent(query);
        const url = `https://www.overpass-api.de/api/interpreter?data=${encodedQuery}`;

        const api = await fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });

        const answer = await api.json();
        console.log(JSON.stringify(answer));
        console.log(answer);
    }

    getPolygonFromOverpass();

    let polygon=L.polygon([[[37.7551389, 48.1140951], [37.7559251, 48.1131849], [37.7572793, 48.1126822], [37.7578962, 48.1125138], [37.7584541, 48.1125855], [37.7602082, 48.1119228], [37.7627134, 48.1111062], [37.7654439, 48.1103146], [37.7684963, 48.1093905], [37.7705669, 48.1087601], [37.7715969, 48.1084556], [37.7748853, 48.1075816], [37.7750462, 48.1072199], [37.7787852, 48.1069333], [37.7818161, 48.1072342], [37.783184, 48.1074204], [37.7845305, 48.10775], [37.7864563, 48.1083697], [37.7884465, 48.1091899], [37.7907908, 48.110157], [37.7920407, 48.1102287], [37.7946049, 48.1113068], [37.7978933, 48.1124959], [37.7993202, 48.1118369], [37.8012031, 48.1132301], [37.8016774, 48.1137831], [37.8017127, 48.1149314], [37.8026891, 48.1162422], [37.8046685, 48.1175279], [37.8060761, 48.1174533], [37.8076512, 48.1189962], [37.8078818, 48.1199273], [37.8078926, 48.1208441], [37.8073347, 48.1224376], [37.806777, 48.1245346], [37.8060917, 48.126442], [37.8047959, 48.130055], [37.8004441, 48.1422527], [37.7978504, 48.1420934], [37.7946907, 48.1419717], [37.7859628, 48.1413882], [37.7833879, 48.1412647], [37.7832323, 48.1401747], [37.781918, 48.1403215], [37.7807808, 48.1405363], [37.7791822, 48.1410589], [37.7786297, 48.1405219], [37.7768701, 48.1410625], [37.7765644, 48.1423404], [37.776162, 48.1423726], [37.7752876, 48.1435073], [37.7747405, 48.1442268], [37.773453, 48.1459055], [37.7742806, 48.1471269], [37.7727556, 48.147892], [37.7725196, 48.1485792], [37.7715944, 48.1487717], [37.7711677, 48.1482213], [37.7687292, 48.1475663], [37.7684211, 48.1442125], [37.767241, 48.1426805], [37.7612972, 48.1414205], [37.7609539, 48.1419502], [37.759366, 48.1415923], [37.7535295, 48.1492235], [37.7540016, 48.1507696], [37.7550745, 48.1507983], [37.7602672, 48.1513566], [37.7611255, 48.1520294], [37.7623701, 48.1523014], [37.7660823, 48.1511132], [37.7669152, 48.1506248], [37.7736272, 48.1561626], [37.773199, 48.1577784], [37.7665321, 48.1578116], [37.7647618, 48.159001], [37.7545751, 48.1592275], [37.7496932, 48.1585667], [37.7475663, 48.1596336], [37.7508567, 48.1627583], [37.7389876, 48.1619041], [37.7391099, 48.1773831], [37.7115732, 48.1749818], [37.7107, 48.1748846], [37.7101323, 48.1748572], [37.708382, 48.1745801], [37.7038758, 48.1805275], [37.6852875, 48.1738739], [37.6982967, 48.1587421], [37.6977748, 48.157651], [37.6993158, 48.1575565], [37.7096956, 48.1585815], [37.7114131, 48.1562731], [37.7133952, 48.1550679], [37.7173995, 48.152631], [37.7245861, 48.1483574], [37.7316349, 48.1442941], [37.73616, 48.1414765], [37.7365696, 48.1391566], [37.7362561, 48.1390005], [37.7369106, 48.1353705], [37.7361703, 48.1352989], [37.736087, 48.1349465], [37.7350995, 48.1348462], [37.7348436, 48.134495], [37.7295951, 48.1340897], [37.7273142, 48.1327506], [37.7286097, 48.1319007], [37.7318812, 48.129811], [37.733635, 48.1286491], [37.7351326, 48.1275421], [37.7374685, 48.1260465], [37.7375811, 48.1253848], [37.7380535, 48.1214769], [37.7402799, 48.1217486], [37.7402406, 48.1235994], [37.7403399, 48.1242865], [37.740218, 48.1249435], [37.7416202, 48.1250912], [37.7414848, 48.1258416], [37.7498064, 48.1266401], [37.7501771, 48.1218837], [37.7502946, 48.1208102], [37.7522252, 48.1179783], [37.7533042, 48.1161921], [37.7551389, 48.1140951]]])

    for(i=0; i < 300; i++) {
        let p = randomPointInPolygon(polygon).geometry.coordinates
    }


    for(i=0; i < 100; i++) {
        let coord = randomPointInPolygon(polygon).geometry.coordinates
        L.circle([coord[0], coord[1]], {
            fillColor: "url(#radgrad)", // id of the radial gradient
            fillOpacity: 0.7,
            stroke: false,
            radius: 20,
        }).addTo(cities);
    }

    cities.addTo(map);

</script>
</body>
</html>